
<!DOCTYPE html>
<html>
  <head>
    <title>Asheville Transit Redesign - Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
    <script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
    <style type="text/css">
      html { height: 100%; }
      body { height: 100%; margin: 0; padding: 0; }
      .main_page { height: 100%; width:100%; padding: 0; }
      #header{ height:10%; }
      #content{ height:90%; padding:0; }
      #map_canvas { height: 100%; width:100%; padding:0; }
    </style>
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?sensor=false">
    </script>
    <script type="text/javascript">
      var center;
      var map = null;

      var kml_dict = {};
      kml_dict["week-day-route-1"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r1.week.day.kml');
      //kml_dict["week-day-route-1"] = new google.maps.KmlLayer('./r1.week.day.kml');
      kml_dict["week-day-route-2"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r2.week.day.kml');
      kml_dict["week-day-route-4"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r4.week.day.kml');
      kml_dict["week-day-route-5"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r5.week.day.kml');
      kml_dict["week-day-route-6"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r6.week.day.kml');
      kml_dict["week-day-route-8"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r8.week.day.kml');
      kml_dict["week-day-route-9"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r9.week.day.kml');
      kml_dict["week-day-route-11"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r11.week.day.kml');
      kml_dict["week-day-route-12"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r12.week.day.kml');
      kml_dict["week-day-route-13"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r13.week.day.kml');
      kml_dict["week-day-route-15"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r15.week.day.kml');
      kml_dict["week-day-route-16"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r16.week.day.kml');
      kml_dict["week-day-route-18"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r18.week.day.kml');
      kml_dict["week-day-route-26"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r26.week.day.kml');
      kml_dict["week-day-route-170"] = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/r170.week.day.kml');
      transit_center_day_map = new google.maps.KmlLayer('http://www.ethanshepherd.com/static/kml/transit.center.day.kml');

      function initialize(){
        resizeMap();
        if(navigator.geolocation){
          //detectBrowser();
          navigator.geolocation.getCurrentPosition(
            //success callback
            function(position){
              newMap(position.coords.latitude, position.coords.longitude);
            },
            //error callback, usually because user declines geolocation
            function(){
              newMap(35.592793,-82.555710);
            }
          );
        }else{ //user doesn't have geolocation
          //detectBrowser();
          newMap(35.592793,-82.555710);
        }
        setRoutes("week-day");
      };

      function newMap(lat,lng){
        center = new google.maps.LatLng(lat,lng);
        var myOptions = {
          center: center,
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.TERRAIN
        };
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        addRoutes("week-day-all-routes");
        //addRoutes("route-2");
      };

      function addRoutes(routes){
        if(routes==="week-day-all-routes"){
          $.each(kml_dict, function(index, route){
            route.setMap(map);
          });
        }else{
          $.each(kml_dict, function(index, route){
            route.setMap(null);
          });
          kml_dict[routes].setMap(map);
        }
        transit_center_day_map.setMap(map);
        map.setCenter(center);
      };

      function setRoutes(times){
        switch(times){
          case 'week-day':
            $('#routes').html("\
            <option value='week-day-all-routes'>all routes</option>\
            <option value='week-day-route-1'>route 1</option>\
            <option value='week-day-route-2'>route 2</option>\
            <option value='week-day-route-4'>route 4</option>\
            <option value='week-day-route-5'>route 5</option>\
            <option value='week-day-route-6'>route 6</option>\
            <option value='week-day-route-8'>route 8</option>\
            <option value='week-day-route-9'>route 9</option>\
            <option value='week-day-route-11'>route 11</option>\
            <option value='week-day-route-12'>route 12</option>\
            <option value='week-day-route-13'>route 13</option>\
            <option value='week-day-route-15'>route 15</option>\
            <option value='week-day-route-16'>route 16</option>\
            <option value='week-day-route-18'>route 18</option>\
            <option value='week-day-route-26'>route 26</option>\
            <option value='week-day-route-170'>route 170</option>\
            ");
            break;
          case 'week-ngt':
            $('#routes').html("\
            <option value='week-day-route-36'>route 36</option>\
            <option value='week-day-route-38'>route 38</option>\
            <option value='week-day-route-41'>route 41</option>\
            <option value='week-day-route-46'>route 46</option>\
            <option value='week-day-route-51'>route 51</option>\
            <option value='week-day-route-52'>route 52</option>\
            ");
            break;
          case 'wknd-day':
            break;
          case 'wknd-ngt':
            break;
        }
      };
      
      function resizeMap(){
        $('#map_canvas').height($(window).height()-($('#navbar').height()+2));
      };
 
      function detectBrowser(){
        var useragent = navigator.userAgent;
        var mapdivMap = document.getElementById("map_canvas");
        if(useragent.indexOf('iPhone')!= -1 || useragent.indexOf('Android')!= -1){
          mapdivMap.style.width = '100%';
          mapdivMap.style.height = '100%';
        }else{
          mapdivMap.style.width = '600px';
          mapdivMap.style.height = '800px';
        }
      };
    </script>
  </head>

  <body onload="initialize()">
    <div data-role="page" data-theme="b"id="main_page">
      
      <div id="navbar" data-role="navbar" data-iconpos="right">
        <ul>
          <li>
            <a href="./index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home">Home</a>
          </li>
          <li>
          <select name="select-routes" id="routes" data-native-menu="true" data-icon="gear" onchange="addRoutes(this.value);">
            <option value="">all routes</option>
          </select>
          </li>
          <li>
          <select name="select-times" id="times" data-native-menu="true" data-icon="gear" onChange="setRoutes(this.value)">
            <option value="week-day">Mon-Sat Daytime</option>
            <option value="week-ngt">Mon-Sat Night</option>
<!--            <option value="wknd-day">wknd/day</option>
            <option value="wknd-ngt">wknd/ngt</option>-->
          </select>
          </li>
        </ul>
      </div><!--navbar-->
      
      <div data-role="content" id="content">
        <div id="map_canvas"></div>
      </div>

    </div><!--data-role="page"-->
  </body>
</html>
